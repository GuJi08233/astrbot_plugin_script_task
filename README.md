# AstrBot 动态脚本任务插件

AstrBot 的动态脚本执行插件，支持多种实用功能。

## 🚀 功能特性

### 网络工具
- **公网IP查询** (`/公网`) - 多备用网站智能切换，确保稳定获取公网IP
  - 支持5个备用IP查询网站
  - 自动IP格式验证
  - 完善的错误处理机制

### 校园服务
- **电费查询** (`/电费 学号/房间号`) - 支持学号与房间号智能绑定
  - 首次使用完整学号查询
  - 支持房间号快捷查询（如 `/电费 834`）
  - 手动绑定房间号（如 `/绑定房间 834 20225080905096`）
  - 本地数据持久化存储

### 脚本管理
- **脚本列表** (`/script`) - 查看所有可用脚本
- **重载脚本** (`/reload`) - 重新加载所有脚本
- **绑定管理** (`/电费绑定`) - 查看电费查询的房间号绑定列表
- **绑定房间** (`/绑定房间 房间号 学号`) - 手动绑定房间号
- **解绑房间** (`/解绑房间 房间号`) - 解除房间号绑定

## 🔐 权限管理

所有命令都需要管理员权限才能使用，使用AstrBot原生的权限系统。

### 管理员权限
- 仅管理员用户可以使用所有命令
- 使用 `@filter.permission_type(filter.PermissionType.ADMIN)` 装饰器实现
- 无需额外配置，遵循AstrBot的用户权限管理

## 📁 文件结构

```
astrbot_plugin_script_task/
├── main.py              # 主插件文件
├── metadata.yaml        # 插件元数据
├── README.md           # 说明文档
└── script/             # 脚本目录
    ├── 公网ip.py       # 公网IP查询脚本
    └── 电费.py         # 电费查询脚本
└── data/               # 数据存储目录
    └── room_mapping.json # 学号房间号映射数据
```

## 💡 使用示例

### 公网IP查询
```
/公网
# 返回：您的公网IP地址是：123.123.123.123
```

### 电费查询
```
# 首次查询（使用完整学号）
/电费 20225080905096
# 返回：房间号: X栋X单元X号
#      当前电量: 123.45 度

# 绑定房间号（手动绑定）
/绑定房间 834 20225080905096
# 返回：绑定成功！房间号: 834 -> 学号: 20225080905096

# 后续查询（使用房间号）
/电费 834
# 返回：房间号: X栋X单元X号
#      当前电量: 120.12 度
```

### 绑定管理
```
/电费绑定
# 返回：电费查询绑定列表：
#      房间号: 834 -> 学号: 20225080905096 (房间: X栋X单元X号)

/解绑房间 834
# 返回：解除绑定成功！房间号 834 已删除
```

## ⚠️ 注意事项

1. 所有命令都需要管理员权限
2. 电费查询功能依赖第三方API，可能存在网络延迟
3. 支持手动绑定房间号，方便记忆和使用
4. 数据文件存储在插件目录的 `script/` 文件夹中

## 🔧 技术支持

- [AstrBot 官方文档](https://astrbot.app)
- 插件仓库：[GitHub](https://github.com/GuJi08233/astrbot_plugin_script_task)

## 📄 更新日志

### v1.5
- 电费查询功能优化，支持手动绑定房间号
- 新增 `/绑定房间` 和 `/解绑房间` 命令
- 优化命令格式，使用房间号作为快捷码
- 更新提示信息，更符合用户习惯

### v1.4
- 使用AstrBot原生管理员权限系统
- 公网IP查询支持多备用网站
- 电费查询支持学号与房间号绑定功能
- 新增快捷码查询功能
- 添加绑定管理功能